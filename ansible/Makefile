# ansible/Makefile
generate-inventory:
	../terraform/generate_inventory.sh
	@echo "‚úÖ inventory.ini —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω"

deploy: generate-inventory
	ansible-playbook -i inventory.ini playbook.yml --vault-password-file <(echo 'secret')

clean:
	@echo "üßπ –û—á–∏—Å—Ç–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö..."
	ansible all -i inventory.ini -m shell -a "docker stop redmine_app redmine_mysql || true"
	ansible all -i inventory.ini -m shell -a "docker rm redmine_app redmine_mysql || true"

status:
	ansible all -i inventory.ini -m shell -a "docker ps -a"

logs:
	ansible all -i inventory.ini -m shell -a "docker logs redmine_app"
	ansible all -i inventory.ini -m shell -a "docker logs redmine_mysql"
