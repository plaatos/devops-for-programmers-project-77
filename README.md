# devops-for-programmers-project-77

[![Actions Status](https://github.com/plaatos/devops-for-programmers-project-77/actions/workflows/hexlet-check.yml/badge.svg )](https://github.com/plaatos/devops-for-programmers-project-77/actions )

## –î–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é
üîó [–ü–µ—Ä–µ–π—Ç–∏ –∫ Redmine](https://test-step.ru )  
![Upmon Status](https://www.upmon.com/badge/63aaee31-2b07-4e54-91a2-5fcaef/IxKr_bO0-2.svg )  [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ Upmon](https://upmon.net/29cfdebb-3552-4726-9d9a-5996b04ee273 )  

---

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç DevOps-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Redmine —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Terraform –∏ Ansible. –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –≤ Yandex Cloud –∏ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑:

- 2 –í–ú —Å Docker
- –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏ (Yandex Application Load Balancer)
- DNS-–∑–∞–ø–∏—Å–∏ –¥–ª—è –¥–æ–º–µ–Ω–∞ `test-step.ru`
- –ü–æ–¥–¥–µ—Ä–∂–∫–∏ HTTPS —Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —á–µ—Ä–µ–∑ Datadog
- –ü—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ Upmon

---

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –æ–∫—Ä—É–∂–µ–Ω–∏—é

- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π [Terraform](https://www.terraform.io/ )
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π [Ansible](https://docs.ansible.com/ )
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π [Make](https://www.gnu.org/software/make/ )
- –£—á–µ—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å –≤ [Yandex Cloud](https://cloud.yandex.ru/ )
- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ–º–µ–Ω (–≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ ‚Äî `test-step.ru`)
- API –∫–ª—é—á Datadog

---

## –ö–∞–∫ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –ø—Ä–æ–µ–∫—Ç

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
```bash
git clone https://github.com/plaatos/devops-for-programmers-project-77.git 
cd devops-for-programmers-project-77
```

2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ —Ñ–∞–π–ª–µ `terraform/secrets.auto.tfvars` –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã:
   - `yc_token` ‚Äî —Ç–æ–∫–µ–Ω Yandex Cloud
   - `ssh_keys` ‚Äî SSH-–∫–ª—é—á –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –í–ú
   - `datadog_api_key` ‚Äî API-–∫–ª—é—á Datadog

> üîê –í—Å–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã –∏–ª–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.

---

### –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (Terraform)

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã –≤ Yandex Cloud.

```bash
make terraform-init
make terraform-apply
```

–≠—Ç–∏ –∫–æ–º–∞–Ω–¥—ã —Å–æ–∑–¥–∞–¥—É—Ç:
- –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã
- –í–∏—Ä—Ç—É–∞–ª—å–Ω—É—é —Å–µ—Ç—å –∏ –ø–æ–¥—Å–µ—Ç—å
- –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ –Ω–∞–≥—Ä—É–∑–∫–∏
- DNS-–∑–∞–ø–∏—Å–∏
- –¶–µ–ª–µ–≤—É—é –≥—Ä—É–ø–ø—É

---

### –î–µ–ø–ª–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (Ansible)

```bash
make ansible-deploy
```

–ë—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω playbook, –∫–æ—Ç–æ—Ä—ã–π:
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç Docker –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ã
- –†–∞–∑–≤–µ—Ä–Ω–µ—Ç Redmine –∏ MySQL –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö
- –ù–∞—Å—Ç—Ä–æ–∏—Ç `.env` —Ñ–∞–π–ª –¥–ª—è Redmine

> üîê –î–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–µ–∫—Ä–µ—Ç–∞–º–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `vault.yml`.

#### –î–æ—Å—Ç—É–ø–Ω—ã–µ Makefile-–∫–æ–º–∞–Ω–¥—ã:

| –ö–æ–º–∞–Ω–¥–∞                | –û–ø–∏—Å–∞–Ω–∏–µ                             |
|------------------------|--------------------------------------|
| `make deploy`          | –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª: –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ + Ansible |
| `make terraform-init`  | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Terraform               |
| `make terraform-apply` | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Terraform     |
| `make wait-for-ssh`    | –û–∂–∏–¥–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ SSH –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö  |
| `make generate-inventory` | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è inventory.ini            |
| `make ansible-deploy`  | –í—ã–ø–æ–ª–Ω–∏—Ç—å Ansible-–ø–ª–µ–π–±—É–∫             |
| `make ansible-clean`   | –û—á–∏—Å—Ç–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö       |
| `make terraform-destroy` | –£–¥–∞–ª–∏—Ç—å –≤—Å—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É          |
| `make clean-artifacts` | –£–¥–∞–ª–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã               |
| `make status`          | –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤           |
| `make logs`            | –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤           |


---

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ù–∞ —Å–µ—Ä–≤–µ—Ä—ã —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∞–≥–µ–Ω—Ç Datadog. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø–ª–µ–π–±—É–∫–µ `playbook.yml`. –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ:

```bash
make ansible-deploy
```

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Redmine –ø–æ URL: `http://localhost:3000`
- –û—Ç–ø—Ä–∞–≤–∫–∞ –º–µ—Ç—Ä–∏–∫ –≤ Datadog
- –ê–ª–µ—Ä—Ç—ã –Ω–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å

---

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–∞

–°–µ—Ä–≤–∏—Å –¥–æ–±–∞–≤–ª–µ–Ω –≤ [Upmon](https://upmon.net/29cfdebb-3552-4726-9d9a-5996b04ee273 ) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Ç–æ—á–µ–∫ –º–∏—Ä–∞.

---

## –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **IaC**: Terraform
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: Ansible
- **–û–±–ª–∞—á–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä**: Yandex Cloud
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: Datadog
- **–ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å**: Upmon
- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è**: Docker
- **CI/CD**: GitHub Actions

---
